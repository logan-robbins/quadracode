# Repository Guidelines

## Project Structure & Module Organization
This monorepo hosts several Python 3.12 packages. `quadracode-runtime/` contains the shared LangGraph workflow, messaging utilities, and tool registry used by every service. `quadracode-agent/` and `quadracode-orchestrator/` wrap the runtime with role-specific profiles and LangGraph configs (`langgraph-local.json`) for local runs. `quadracode-agent-registry/` provides the uvicorn-based registry API and health endpoints exposed on port 8090. Contract models live in `quadracode-contracts/`, while `quadracode-tools/` exposes reusable MCP and LangChain tool wrappers. Dockerfiles sit alongside each service, and integration assets live under `scripts/` and `tests/e2e/`.

## Build, Test, and Development Commands
Install dependencies by running `uv sync` inside each package directory (uv respects the sibling paths declared in `pyproject.toml`). Use `uv run langgraph dev agent --config quadracode-agent/langgraph-local.json` or swap `agent` with `orchestrator` to start a local graph server. Launch the full stack via `docker compose up redis agent orchestrator agent-registry` from the repo root; the e2e suite relies on that command. Execute fast feedback with `uv run pytest` in the target package, and run the integration check with `uv run pytest tests/e2e -m e2e`. `scripts/launch_agent.sh` wraps the agent container with an autogenerated `QUADRACODE_ID`.

## Coding Style & Naming Conventions
Follow PEP 8: four-space indentation, type hints throughout, `snake_case` for functions, and `PascalCase` for Pydantic models and LangGraph node classes. Keep modules cohesive by colocating prompt text under `prompts/` and runtime states under `state.py`. Favor dataclasses or Pydantic models for message payloads, and update shared contracts before introducing ad-hoc dictionaries. Ensure new tools register through `QuadracodeTools` so both agent and orchestrator pick them up.

## Testing Guidelines
Pytest is the canonical framework. Place fast unit tests beside the package that owns the code and name files `test_*.py`. Mark cross-service flows with `@pytest.mark.e2e` and keep them under `tests/e2e/`; these tests bootstrap Docker Compose, so clean containers with `docker compose down -v` when debugging failures. Add regression fixtures that assert Redis stream behavior whenever message formats change. For the context engine, keep `quadracode-runtime/tests/test_context_tool_ingestion.py`, `test_context_usage_accounting.py`, `test_context_metrics_events.py`, and `test_context_governor.py` green before merging.

## Commit & Pull Request Guidelines
Adopt Conventional Commit prefixes (`feat:`, `fix:`, `docs:`, `refactor:`) followed by a present-tense summary under 70 characters. Reference issue IDs or tickets in the body and list breaking changes explicitly. Pull requests should describe the affected services, include reproduction or testing notes (`uv run pytest`, `docker compose up` logs), and attach screenshots only when UI tooling is impacted. Request review from runtime and registry owners whenever interfaces in `quadracode-contracts` evolve.
